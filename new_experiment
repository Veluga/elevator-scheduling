#!/bin/bash

if [[ -z "$1" ]]; then
    echo "Require experiment name."
    exit 1
fi

LATEST=$(ls -t experiments | head -n1 | sed 's/\([0-9]*\).*/\1/g')
LATEST=$((LATEST + 1))
DIRNAME="./experiments/${LATEST}_$1"
mkdir "$DIRNAME"

cp tf_controller.py "$DIRNAME"
cp -r agent "$DIRNAME"
cp -r building "$DIRNAME"
cp -r caller "$DIRNAME"
cp settings.py "$DIRNAME"

mkdir "${DIRNAME}/weights"
mkdir "${DIRNAME}/plots"
touch "${DIRNAME}/model_log.txt"

vim "${DIRNAME}/settings.py"

python "${DIRNAME}/tf_controller.py" &> "${DIRNAME}/model_log.txt" &